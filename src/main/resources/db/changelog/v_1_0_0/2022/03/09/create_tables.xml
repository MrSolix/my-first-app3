<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.5.xsd">

    <changeSet id="1646923667211-1" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="users"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE users
            (id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            user_name VARCHAR(50) NOT NULL,
            password VARCHAR(255),
            name VARCHAR(50),
            age INTEGER,
            user_type VARCHAR(50),
            CONSTRAINT users_pkey PRIMARY KEY (id));
        </sql>
    </changeSet>

    <changeSet id="1646923667211-8" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="salaries"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE salaries
            (teacher_id BIGINT NOT NULL,
            salary numeric NOT NULL,
            CONSTRAINT salary_teacher_id_fkey FOREIGN KEY(teacher_id)
            REFERENCES users(id));
        </sql>
    </changeSet>
    
    <changeSet id="1646923667211-3" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="authority"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE authority (
            id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            name VARCHAR(50) NOT NULL,
            CONSTRAINT authority_pkey PRIMARY KEY (id));
        </sql>
    </changeSet>

    <changeSet id="1646923667211-7" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="role"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE role
            (id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            name VARCHAR(50) NOT NULL,
            CONSTRAINT role_pkey PRIMARY KEY (id));
        </sql>
    </changeSet>

    <changeSet id="1646923667211-10" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_role"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE user_role
            (user_id INTEGER NOT NULL,
            role_id INTEGER NOT NULL,
            CONSTRAINT user_role_user_id_fkey FOREIGN KEY(user_id)
            REFERENCES users(id),
            CONSTRAINT user_role_role_id_fkey FOREIGN KEY(role_id)
            REFERENCES role(id));
        </sql>
    </changeSet>

    <changeSet id="1646923667211-9" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="user_authority"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE user_authority
            (user_id INTEGER NOT NULL,
            authority_id INTEGER NOT NULL,
            CONSTRAINT user_authority_authority_id_fkey FOREIGN KEY (authority_id)
            REFERENCES authority (id),
            CONSTRAINT user_authority_user_id_fkey FOREIGN KEY (user_id)
            REFERENCES users (id));

        </sql>
    </changeSet>

    <changeSet id="1646923667211-5" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="group"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "group"
            (id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            teacher_id INTEGER,
            CONSTRAINT group_pkey PRIMARY KEY (id),
            CONSTRAINT group_teacher_id_fkey FOREIGN KEY(teacher_id)
            REFERENCES users(id));
        </sql>
    </changeSet>

    <changeSet id="1646923667211-4" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="grades"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE grades
            (id INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
            theme_name VARCHAR(50) NOT NULL, grade INTEGER NOT NULL,
            student_id INTEGER,
            CONSTRAINT grades_pkey PRIMARY KEY (id),
            CONSTRAINT grades_student_id_fkey FOREIGN KEY(student_id)
            REFERENCES users(id));
        </sql>
    </changeSet>

    <changeSet id="1646923667211-6" author="vyacheslav">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="group_student"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE group_student
            (group_id INTEGER,
            student_id INTEGER,
            CONSTRAINT student_group_id_fkey FOREIGN KEY(group_id)
            REFERENCES "group"(id),
            CONSTRAINT group_student_id_fkey FOREIGN KEY(student_id)
            REFERENCES users(id));
        </sql>
    </changeSet>
    
</databaseChangeLog>